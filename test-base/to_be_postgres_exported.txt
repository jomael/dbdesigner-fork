CREATE TABLE CLIENT (
  CLIENT_ID INTEGER   NOT NULL ,
  CLIENT_NAME VARCHAR(100)   NOT NULL ,
  CLIENT_VALUE FLOAT   NOT NULL ,
  CLIENT_FLAG CHAR(1)    ,
  CLIENT_CODE VARCHAR(25)   NOT NULL , 
  DT_ATUALIZACAO VARCHAR(15), 
  USUARIO INTEGER   ,
PRIMARY KEY(CLIENT_ID)  );


CREATE UNIQUE INDEX CLIENT_ID_CODE ON CLIENT (CLIENT_CODE);


CREATE OR REPLACE TRIGGER UPDT_CLIENT
BEFORE INSERT OR UPDATE  ON CLIENT
FOR EACH ROW 
BEGIN
  :NEW.DT_ATUALIZACAO :=  TO_CHAR(SYSTIMESTAMP, 'YYMMDDHH24MISSFF3');
END;

select 
EXTRACT(year from now()) || 
EXTRACT(month from now()) || 
EXTRACT(day from now()) || 
EXTRACT(hour from now()) || 
EXTRACT(minute from now()) ||
EXTRACT(MICROSECONDS from now())

CREATE FUNCTION upd_timestamp() RETURNS trigger AS $upd_timestamp$
    BEGIN
        NEW.DT_ATUALIZACAO :=  EXTRACT(year from now()) || 
EXTRACT(month from now()) || 
EXTRACT(day from now()) || 
EXTRACT(hour from now()) || 
EXTRACT(minute from now()) ||
EXTRACT(MICROSECONDS from now());
        RETURN NEW;
    END;
$upd_timestamp$ LANGUAGE plpgsql;
/


COMMENT ON COLUMN CLIENT.CLIENT_ID IS 'Client''s PK';
COMMENT ON COLUMN CLIENT.CLIENT_NAME IS 'Client''s name.';



CREATE TABLE CONTACT (
  CONTACT_ID INTEGER   NOT NULL ,
  CLIENT_ID INTEGER   NOT NULL ,
  CONTACT_NAME VARCHAR(100)   NOT NULL , 
  DT_ATUALIZACAO VARCHAR(15), 
  USUARIO INTEGER   ,
PRIMARY KEY(CONTACT_ID)  ,
  FOREIGN KEY(CLIENT_ID)
    REFERENCES CLIENT(CLIENT_ID)
      ON DELETE CASCADE
);


CREATE INDEX CONTACT_FKIndex1 ON CONTACT (CLIENT_ID);


CREATE OR REPLACE TRIGGER UPDT_CONTACT
BEFORE INSERT OR UPDATE  ON CONTACT
FOR EACH ROW 
BEGIN
  :NEW.DT_ATUALIZACAO :=  TO_CHAR(SYSTIMESTAMP, 'YYMMDDHH24MISSFF3');
END;

/


CREATE INDEX IFK_R_CLIENT_CONTACT ON CONTACT (CLIENT_ID);


